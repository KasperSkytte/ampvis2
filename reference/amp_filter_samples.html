<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Subset ampvis2 objects based on sample metadata — amp_filter_samples • ampvis2</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Subset ampvis2 objects based on sample metadata — amp_filter_samples"><meta property="og:description" content="Subsets the data in ampvis2 objects based on metadata and returns the subsetted object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93913019-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93913019-2');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ampvis2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.8.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/ampvis2.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/faq.html">FAQ</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kasperskytte/ampvis2" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>

    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Subset ampvis2 objects based on sample metadata</h1>
    <small class="dont-index">Source: <a href="https://github.com/kasperskytte/ampvis2/blob/main/R/amp_filter_samples.R" class="external-link"><code>R/amp_filter_samples.R</code></a></small>
    <div class="hidden name"><code>amp_filter_samples.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Subsets the data in ampvis2 objects based on metadata and returns the subsetted object.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">amp_filter_samples</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  minreads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rarefy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  removeAbsentOTUs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">amp_subset_samples</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  minreads <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  rarefy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  removeAbsentOTUs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>(<em>required</em>) Data list as loaded with <code><a href="amp_load.html">amp_load</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Logical expression indicating elements or rows to keep in the metadata. Missing values are treated as <code>FALSE</code>. Passed directly to <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></code>.</p></dd>


<dt id="arg-minreads">minreads<a class="anchor" aria-label="anchor" href="#arg-minreads"></a></dt>
<dd><p>Minimum number of reads pr. sample. Samples below this value will be removed <em>initially</em>. (<em>default:</em> <code>0</code>)</p></dd>


<dt id="arg-rarefy">rarefy<a class="anchor" aria-label="anchor" href="#arg-rarefy"></a></dt>
<dd><p>Rarefy species richness to this value by using <code><a href="https://vegandevs.github.io/vegan/reference/rarefy.html" class="external-link">rrarefy</a></code>. This is done <em>initially</em>, but <em>after</em> filtering based on the <code>minreads</code> value, if set. (<em>default:</em> <code>NULL</code>)</p></dd>


<dt id="arg-normalise">normalise<a class="anchor" aria-label="anchor" href="#arg-normalise"></a></dt>
<dd><p>(<em>logical</em>) Normalise the OTU read counts to 100 (ie percent) per sample <em>BEFORE</em> the subset. (<em>default:</em> <code>FALSE</code>)</p></dd>


<dt id="arg-removeabsentotus">removeAbsentOTUs<a class="anchor" aria-label="anchor" href="#arg-removeabsentotus"></a></dt>
<dd><p>(<em>logical</em>) Whether to remove OTU's that may have 0 read abundance in all samples after the subset. (<em>default:</em> <code>TRUE</code>)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A modifed ampvis2 object</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The subset is performed on the metadata by <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> and the abundance- and taxonomy tables are then adjusted accordingly.</p>
    </div>
    <div id="preserving-relative-abundances-in-a-subset-of-larger-data">
    <h2>Preserving relative abundances in a subset of larger data</h2>


<p>By default the raw read counts in the abundance matrix are normalised (transformed to percentages) by some plotting functions automatically (for example <code><a href="amp_heatmap.html">amp_heatmap</a></code>, <code><a href="amp_timeseries.html">amp_timeseries</a></code>, and more). This means that the relative abundances shown will be calculated based on the remaining taxa after the subset, not including the removed taxa, if any. To circumvent this, set <code>normalise = TRUE</code> when subsetting with the <code><a href="amp_filter_taxa.html">amp_filter_taxa</a></code> and <code>amp_filter_samples</code> functions, and then set <code>normalise = FALSE</code> in the plotting function. This will transform the OTU counts to relative abundances BEFORE the subset, and setting <code>normalise = FALSE</code> will skip the transformation in the plotting function, see the example below.</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"MiDAS"</span><span class="op">)</span></span>
<span><span class="va">subsettedData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amp_filter_samples.html">amp_filter_samples</a></span><span class="op">(</span><span class="va">MiDAS</span>,</span>
<span>                                    <span class="va">Plant</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aalborg West"</span>, <span class="st">"Aalborg East"</span><span class="op">)</span>,</span>
<span>                                    normalise <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                                    <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/amp_heatmap.html">amp_heatmap</a></span><span class="op">(</span><span class="va">subsettedData</span>,</span>
<span>            group_by <span class="op">=</span> <span class="st">"Plant"</span>,</span>
<span>            tax_aggregate <span class="op">=</span> <span class="st">"Phylum"</span>,</span>
<span>            tax_add <span class="op">=</span> <span class="st">"Genus"</span>,</span>
<span>            normalise <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>            <span class="op">)</span></span></code></pre></div>

    </div>
    <div id="references">
    <h2>References</h2>
    <p>McMurdie, P.J. &amp; Holmes, S. (2014). Waste not, want not: Why
rarefying microbiome data is inadmissible. <em>PLoS Comput Biol</em>
<strong>10(4):</strong> e1003531. DOI:<code>10.1371/journal.pcbi.1003531</code></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="amp_load.html">amp_load</a></code>, <code><a href="amp_filter_taxa.html">amp_filter_taxa</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Kasper Skytte Andersen <a href="mailto:ksa@bio.aau.dk">ksa@bio.aau.dk</a></p>
<p>Mads Albertsen <a href="mailto:MadsAlbertsen85@gmail.com">MadsAlbertsen85@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"MiDAS"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Show a short summary about the data by simply typing the name of the object in the console</span></span></span>
<span class="r-in"><span><span class="va">MiDAS</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ampvis2 object with 5 elements. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Summary of OTU table:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Samples         OTUs  Total#Reads    Min#Reads    Max#Reads Median#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          658        14969     20890850        10480        46264        31800 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Avg#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     31749.01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Assigned taxonomy:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Kingdom        Phylum         Class         Order        Family </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   14969(100%) 14477(96.71%) 12737(85.09%) 11470(76.63%)  9841(65.74%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Genus       Species </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   7380(49.3%)     28(0.19%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Metadata variables:</span> 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  SampleID, Plant, Date, Year, Period</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Keep only samples containing Aalborg West or East in the Plant column</span></span></span>
<span class="r-in"><span><span class="va">MiDASsubset</span> <span class="op">&lt;-</span> <span class="fu">amp_filter_samples</span><span class="op">(</span><span class="va">MiDAS</span>, <span class="va">Plant</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aalborg West"</span>, <span class="st">"Aalborg East"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 590 samples and 5512 OTUs have been filtered </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Before: 658 samples and 14969 OTUs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> After: 68 samples and 9457 OTUs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summary</span></span></span>
<span class="r-in"><span><span class="va">MiDASsubset</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ampvis2 object with 5 elements. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Summary of OTU table:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Samples         OTUs  Total#Reads    Min#Reads    Max#Reads Median#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           68         9457      2072678        17772        44326      30962.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Avg#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     30480.56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Assigned taxonomy:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Kingdom       Phylum        Class        Order       Family        Genus </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   9457(100%) 9240(97.71%) 8305(87.82%) 7665(81.05%) 6767(71.56%) 5244(55.45%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    23(0.24%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Metadata variables:</span> 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  SampleID, Plant, Date, Year, Period</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Keep only samples containing Aalborg West or East in the Plant column</span></span></span>
<span class="r-in"><span><span class="co"># and remove the sample "16SAMP-749". Remove any sample(s) with less than 20000 total reads</span></span></span>
<span class="r-in"><span><span class="va">MiDASsubset2</span> <span class="op">&lt;-</span> <span class="fu">amp_filter_samples</span><span class="op">(</span><span class="va">MiDAS</span>,</span></span>
<span class="r-in"><span>  <span class="va">Plant</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aalborg West"</span>, <span class="st">"Aalborg East"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">SampleID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"16SAMP-749"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  minreads <span class="op">=</span> <span class="fl">20000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 594 samples and 5601 OTUs have been filtered </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Before: 658 samples and 14969 OTUs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> After: 64 samples and 9368 OTUs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summary</span></span></span>
<span class="r-in"><span><span class="va">MiDASsubset2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ampvis2 object with 5 elements. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Summary of OTU table:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Samples         OTUs  Total#Reads    Min#Reads    Max#Reads Median#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           64         9368      1987574        21472        44326      31413.5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Avg#Reads </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     31055.84 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Assigned taxonomy:</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Kingdom       Phylum        Class        Order       Family        Genus </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   9368(100%) 9154(97.72%) 8222(87.77%) 7589(81.01%) 6699(71.51%) 5194(55.44%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    23(0.25%) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="text-decoration: underline;">Metadata variables:</span> 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  SampleID, Plant, Date, Year, Period</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kasper Skytte Andersen, Mads Albertsen, Rasmus Hansen Kirkegaard.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: 'b0ba3a3eb751685982ccf010113f380a',
    indexName: 'ampvis2',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

